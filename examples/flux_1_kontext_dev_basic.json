{
  "id": "7cbcec68-7fa6-47bb-a38a-da689949a001",
  "revision": 0,
  "last_node_id": 268,
  "last_link_id": 452,
  "nodes": [
    {
      "id": 39,
      "type": "VAELoader",
      "pos": [
        -400,
        390
      ],
      "size": [
        337.76861572265625,
        58
      ],
      "flags": {},
      "order": 0,
      "mode": 4,
      "inputs": [],
      "outputs": [
        {
          "label": "VAE",
          "name": "VAE",
          "type": "VAE",
          "links": [
            61,
            223
          ]
        }
      ],
      "properties": {
        "cnr_id": "comfy-core",
        "ver": "0.3.38",
        "Node name for S&R": "VAELoader",
        "models": [
          {
            "name": "ae.safetensors",
            "url": "https://huggingface.co/Comfy-Org/Lumina_Image_2.0_Repackaged/resolve/main/split_files/vae/ae.safetensors",
            "directory": "vae"
          }
        ],
        "widget_ue_connectable": {}
      },
      "widgets_values": [
        "ae.safetensors"
      ],
      "color": "#322",
      "bgcolor": "#533"
    },
    {
      "id": 135,
      "type": "ConditioningZeroOut",
      "pos": [
        250,
        200
      ],
      "size": [
        240,
        26
      ],
      "flags": {
        "collapsed": false
      },
      "order": 49,
      "mode": 4,
      "inputs": [
        {
          "label": "conditioning",
          "name": "conditioning",
          "type": "CONDITIONING",
          "link": 237
        }
      ],
      "outputs": [
        {
          "label": "CONDITIONING",
          "name": "CONDITIONING",
          "type": "CONDITIONING",
          "links": [
            238
          ]
        }
      ],
      "properties": {
        "cnr_id": "comfy-core",
        "ver": "0.3.39",
        "Node name for S&R": "ConditioningZeroOut",
        "widget_ue_connectable": {}
      },
      "widgets_values": []
    },
    {
      "id": 31,
      "type": "KSampler",
      "pos": [
        530,
        40
      ],
      "size": [
        320,
        474
      ],
      "flags": {},
      "order": 52,
      "mode": 4,
      "inputs": [
        {
          "label": "model",
          "name": "model",
          "type": "MODEL",
          "link": 399
        },
        {
          "label": "positive",
          "name": "positive",
          "type": "CONDITIONING",
          "link": 57
        },
        {
          "label": "negative",
          "name": "negative",
          "type": "CONDITIONING",
          "link": 238
        },
        {
          "label": "latent_image",
          "name": "latent_image",
          "type": "LATENT",
          "link": 291
        }
      ],
      "outputs": [
        {
          "label": "LATENT",
          "name": "LATENT",
          "type": "LATENT",
          "slot_index": 0,
          "links": [
            52
          ]
        }
      ],
      "properties": {
        "cnr_id": "comfy-core",
        "ver": "0.3.38",
        "Node name for S&R": "KSampler",
        "widget_ue_connectable": {}
      },
      "widgets_values": [
        402808421904588,
        "randomize",
        20,
        1,
        "euler",
        "simple",
        1
      ]
    },
    {
      "id": 175,
      "type": "MarkdownNote",
      "pos": [
        -50,
        640
      ],
      "size": [
        320,
        88
      ],
      "flags": {},
      "order": 1,
      "mode": 4,
      "inputs": [],
      "outputs": [],
      "title": "About Flux Kontext Edit",
      "properties": {
        "widget_ue_connectable": {}
      },
      "widgets_values": [
        "[English] Use Ctrl + B to enable multipule image input.\n\n[中文] 使用 **Ctrl + B** 来启用多张图片输入"
      ],
      "color": "#432",
      "bgcolor": "#653"
    },
    {
      "id": 35,
      "type": "FluxGuidance",
      "pos": [
        250,
        90
      ],
      "size": [
        240,
        58
      ],
      "flags": {
        "collapsed": false
      },
      "order": 51,
      "mode": 4,
      "inputs": [
        {
          "label": "conditioning",
          "name": "conditioning",
          "type": "CONDITIONING",
          "link": 292
        }
      ],
      "outputs": [
        {
          "label": "CONDITIONING",
          "name": "CONDITIONING",
          "type": "CONDITIONING",
          "slot_index": 0,
          "links": [
            57
          ]
        }
      ],
      "properties": {
        "cnr_id": "comfy-core",
        "ver": "0.3.38",
        "Node name for S&R": "FluxGuidance",
        "widget_ue_connectable": {}
      },
      "widgets_values": [
        2.5
      ]
    },
    {
      "id": 185,
      "type": "MarkdownNote",
      "pos": [
        -960,
        490
      ],
      "size": [
        510,
        170
      ],
      "flags": {},
      "order": 2,
      "mode": 4,
      "inputs": [],
      "outputs": [],
      "title": "About VRAM",
      "properties": {
        "widget_ue_connectable": {}
      },
      "widgets_values": [
        "For reference:\n- **fp8_scaled**: Requires about 20GB of VRAM.\n- **Original**: Requires about 32GB of VRAM.\n\n---\n\n供参考：\n-  **fp8_scaled** :  大概需要 20GB 左右 VRAM \n- **原始权重**:  原始权重，大概需要 32GB 左右 VRAM \n"
      ],
      "color": "#432",
      "bgcolor": "#653"
    },
    {
      "id": 186,
      "type": "MarkdownNote",
      "pos": [
        -960,
        710
      ],
      "size": [
        510,
        170
      ],
      "flags": {},
      "order": 3,
      "mode": 4,
      "inputs": [],
      "outputs": [],
      "title": "Flux Kontext Prompt Techniques",
      "properties": {
        "widget_ue_connectable": {}
      },
      "widgets_values": [
        "\n## Flux Kontext Prompt Techniques\n\n### 1. Basic Modifications\n- Simple and direct: `\"Change the car color to red\"`\n- Maintain style: `\"Change to daytime while maintaining the same style of the painting\"`\n\n### 2. Style Transfer\n**Principles:**\n- Clearly name style: `\"Transform to Bauhaus art style\"`\n- Describe characteristics: `\"Transform to oil painting with visible brushstrokes, thick paint texture\"`\n- Preserve composition: `\"Change to Bauhaus style while maintaining the original composition\"`\n\n### 3. Character Consistency\n**Framework:**\n- Specific description: `\"The woman with short black hair\"` instead of \"she\"\n- Preserve features: `\"while maintaining the same facial features, hairstyle, and expression\"`\n- Step-by-step modifications: Change background first, then actions\n\n### 4. Text Editing\n- Use quotes: `\"Replace 'joy' with 'BFL'\"`\n- Maintain format: `\"Replace text while maintaining the same font style\"`\n\n## Common Problem Solutions\n\n### Character Changes Too Much\n❌ Wrong: `\"Transform the person into a Viking\"`\n✅ Correct: `\"Change the clothes to be a viking warrior while preserving facial features\"`\n\n### Composition Position Changes\n❌ Wrong: `\"Put him on a beach\"`\n✅ Correct: `\"Change the background to a beach while keeping the person in the exact same position, scale, and pose\"`\n\n### Style Application Inaccuracy\n❌ Wrong: `\"Make it a sketch\"`\n✅ Correct: `\"Convert to pencil sketch with natural graphite lines, cross-hatching, and visible paper texture\"`\n\n## Core Principles\n\n1. **Be Specific and Clear** - Use precise descriptions, avoid vague terms\n2. **Step-by-step Editing** - Break complex modifications into multiple simple steps\n3. **Explicit Preservation** - State what should remain unchanged\n4. **Verb Selection** - Use \"change\", \"replace\" rather than \"transform\"\n\n## Best Practice Templates\n\n**Object Modification:**\n`\"Change [object] to [new state], keep [content to preserve] unchanged\"`\n\n**Style Transfer:**\n`\"Transform to [specific style], while maintaining [composition/character/other] unchanged\"`\n\n**Background Replacement:**\n`\"Change the background to [new background], keep the subject in the exact same position and pose\"`\n\n**Text Editing:**\n`\"Replace '[original text]' with '[new text]', maintain the same font style\"`\n\n> **Remember:** The more specific, the better. Kontext excels at understanding detailed instructions and maintaining consistency. "
      ],
      "color": "#432",
      "bgcolor": "#653"
    },
    {
      "id": 187,
      "type": "MarkdownNote",
      "pos": [
        -960,
        930
      ],
      "size": [
        510,
        180
      ],
      "flags": {},
      "order": 4,
      "mode": 4,
      "inputs": [],
      "outputs": [],
      "title": "Flux Kontext 提示词技巧",
      "properties": {
        "widget_ue_connectable": {}
      },
      "widgets_values": [
        "\n## Flux Kontext 提示词技巧\n\n使用英文\n\n### 1. 基础修改\n- 简单直接：`\"Change the car color to red\"`\n- 保持风格：`\"Change to daytime while maintaining the same style of the painting\"`\n\n### 2. 风格转换\n**原则：**\n- 明确命名风格：`\"Transform to Bauhaus art style\"`\n- 描述特征：`\"Transform to oil painting with visible brushstrokes, thick paint texture\"`\n- 保留构图：`\"Change to Bauhaus style while maintaining the original composition\"`\n\n### 3. 角色一致性\n**框架：**\n- 具体描述：`\"The woman with short black hair\"`而非`\"她\"`\n- 保留特征：`\"while maintaining the same facial features, hairstyle, and expression\"`\n- 分步修改：先改背景，再改动作\n\n### 4. 文本编辑\n- 使用引号：`\"Replace 'joy' with 'BFL'\"`\n- 保持格式：`\"Replace text while maintaining the same font style\"`\n\n## 常见问题解决\n\n### 角色变化过大\n❌ 错误：`\"Transform the person into a Viking\"`\n✅ 正确：`\"Change the clothes to be a viking warrior while preserving facial features\"`\n\n### 构图位置改变\n❌ 错误：`\"Put him on a beach\"`\n✅ 正确：`\"Change the background to a beach while keeping the person in the exact same position, scale, and pose\"`\n\n### 风格应用不准确\n❌ 错误：`\"Make it a sketch\"`\n✅ 正确：`\"Convert to pencil sketch with natural graphite lines, cross-hatching, and visible paper texture\"`\n\n## 核心原则\n\n1. **具体明确** - 使用精确描述，避免模糊词汇\n2. **分步编辑** - 复杂修改分为多个简单步骤\n3. **明确保留** - 说明哪些要保持不变\n4. **动词选择** - 用\"更改\"、\"替换\"而非\"转换\"\n\n## 最佳实践模板\n\n**对象修改：**\n`\"Change [object] to [new state], keep [content to preserve] unchanged\"`\n\n**风格转换：**\n`\"Transform to [specific style], while maintaining [composition/character/other] unchanged\"`\n\n**背景替换：**\n`\"Change the background to [new background], keep the subject in the exact same position and pose\"`\n\n**文本编辑：**\n`\"Replace '[original text]' with '[new text]', maintain the same font style\"`\n\n> **记住：** 越具体越好，Kontext 擅长理解详细指令并保持一致性。"
      ],
      "color": "#432",
      "bgcolor": "#653"
    },
    {
      "id": 184,
      "type": "MarkdownNote",
      "pos": [
        -960,
        40
      ],
      "size": [
        510,
        400
      ],
      "flags": {},
      "order": 5,
      "mode": 4,
      "inputs": [],
      "outputs": [],
      "title": "Model links",
      "properties": {
        "widget_ue_connectable": {}
      },
      "widgets_values": [
        "[tutorial](http://docs.comfy.org/tutorials/flux/flux-1-kontext-dev) | [教程](http://docs.comfy.org/zh-CN/tutorials/flux/flux-1-kontext-dev)\n\n**diffusion model**\n\n- [flux1-dev-kontext_fp8_scaled.safetensors](https://huggingface.co/Comfy-Org/flux1-kontext-dev_ComfyUI/resolve/main/split_files/diffusion_models/flux1-dev-kontext_fp8_scaled.safetensors)\n\n**vae**\n\n- [ae.safetensors](https://huggingface.co/Comfy-Org/Lumina_Image_2.0_Repackaged/blob/main/split_files/vae/ae.safetensors)\n\n**text encoder**\n\n- [clip_l.safetensors](https://huggingface.co/comfyanonymous/flux_text_encoders/blob/main/clip_l.safetensors)\n- [t5xxl_fp16.safetensors](https://huggingface.co/comfyanonymous/flux_text_encoders/resolve/main/t5xxl_fp16.safetensors) or [t5xxl_fp8_e4m3fn_scaled.safetensors](https://huggingface.co/comfyanonymous/flux_text_encoders/resolve/main/t5xxl_fp8_e4m3fn_scaled.safetensors)\n\nModel Storage Location\n\n```\n📂 ComfyUI/\n├── 📂 models/\n│   ├── 📂 diffusion_models/\n│   │   └── flux1-dev-kontext_fp8_scaled.safetensors\n│   ├── 📂 vae/\n│   │   └── ae.safetensor\n│   └── 📂 text_encoders/\n│       ├── clip_l.safetensors\n│       └── t5xxl_fp16.safetensors 或者 t5xxl_fp8_e4m3fn_scaled.safetensors\n```\n"
      ],
      "color": "#432",
      "bgcolor": "#653"
    },
    {
      "id": 180,
      "type": "MarkdownNote",
      "pos": [
        -1430,
        40
      ],
      "size": [
        450,
        450
      ],
      "flags": {},
      "order": 6,
      "mode": 4,
      "inputs": [],
      "outputs": [],
      "title": "✨ New ComfyUI feature for Flux.1 Kontext Dev",
      "properties": {
        "widget_ue_connectable": {}
      },
      "widgets_values": [
        "[English]\nWe have added an **Edit** button to the **Selection Toolbox** of the node for **FLUX.1 Kontext Image Edit** support. When clicked, it quickly adds a **FLUX.1 Kontext Image Edit** group node to the Latent output of your current workflow. This enables an interactive editing experience where you can:\n\n- Create multiple editing iterations, each preserved as a separate node\n- Easily branch off from any previous edit point to explore different creative directions\n- Return to any earlier version and start a new editing branch\n- Modify parameters in earlier nodes and automatically update all downstream edits\n- Execute or re-execute any branch of edits at any time\n\nThis workflow mirrors the iterative nature of LLM conversations, but with the added advantage of visual editing and the ability to maintain multiple parallel editing paths.\n\n---\n\n[中文]\n我们为 **FLUX.1 Kontext Image Edit** 的相关支持在节点的**选择工具箱**上新增了一个**编辑**按钮。点击后，系统会在当前工作流的 Latent 输出上快速添加一个 **FLUX.1 Kontext Image Edit** 的组节点。这种设计带来了灵活的交互式编辑体验：\n\n- 创建多个编辑迭代，每次编辑都会保存为独立节点\n- 可以从任何之前的编辑点分支出新的创作方向\n- 随时返回到早期版本并开始新的编辑分支\n- 修改早期节点的参数，自动更新所有下游编辑\n- 可以随时执行或重新执行任何编辑分支\n\n这种工作流程类似于 LLM 对话的迭代特性，但增加了视觉编辑的优势，并能够维护多个并行的编辑路径。"
      ],
      "color": "#322",
      "bgcolor": "#533"
    },
    {
      "id": 178,
      "type": "MarkdownNote",
      "pos": [
        -30,
        -150
      ],
      "size": [
        540,
        150
      ],
      "flags": {},
      "order": 7,
      "mode": 4,
      "inputs": [],
      "outputs": [],
      "title": "About multiple images reference",
      "properties": {
        "widget_ue_connectable": {}
      },
      "widgets_values": [
        "[English] In addition to using **Image Stitch** to combine two images at a time, you can also encode individual images, then concatenate multiple latent conditions using the **ReferenceLatent** node, thus achieving the purpose of referencing multiple images. You can use the **EmptySD3LatentImage** node on the right to connect to **KSamper** and customize the size of the **latent_image**.\n\n[中文] 除了使用 **Image Stitch** 将两个两个图像拼合之外，你同样可以将单独的图像 encode 之后，将多个 latent 条件使用 **ReferenceLatent** 节点串联，从而实现多张图像参考的目的。可以使用右边的 **EmptySD3LatentImage** 节点连接到 **KSamper**来自定义 **latent_image** 的尺寸"
      ],
      "color": "#432",
      "bgcolor": "#653"
    },
    {
      "id": 188,
      "type": "EmptySD3LatentImage",
      "pos": [
        530,
        -140
      ],
      "size": [
        310,
        106
      ],
      "flags": {},
      "order": 8,
      "mode": 0,
      "inputs": [],
      "outputs": [
        {
          "label": "LATENT",
          "name": "LATENT",
          "type": "LATENT",
          "links": null
        }
      ],
      "properties": {
        "cnr_id": "comfy-core",
        "ver": "0.3.41",
        "Node name for S&R": "EmptySD3LatentImage",
        "widget_ue_connectable": {}
      },
      "widgets_values": [
        1024,
        1024,
        1
      ]
    },
    {
      "id": 38,
      "type": "DualCLIPLoader",
      "pos": [
        -400,
        210
      ],
      "size": [
        337.76861572265625,
        130
      ],
      "flags": {},
      "order": 9,
      "mode": 4,
      "inputs": [],
      "outputs": [
        {
          "label": "CLIP",
          "name": "CLIP",
          "type": "CLIP",
          "links": [
            59
          ]
        }
      ],
      "properties": {
        "cnr_id": "comfy-core",
        "ver": "0.3.38",
        "Node name for S&R": "DualCLIPLoader",
        "models": [
          {
            "name": "clip_l.safetensors",
            "url": "https://huggingface.co/comfyanonymous/flux_text_encoders/resolve/main/clip_l.safetensors",
            "directory": "text_encoders"
          },
          {
            "name": "t5xxl_fp8_e4m3fn_scaled.safetensors",
            "url": "https://huggingface.co/comfyanonymous/flux_text_encoders/resolve/main/t5xxl_fp8_e4m3fn_scaled.safetensors",
            "directory": "text_encoders"
          }
        ],
        "widget_ue_connectable": {}
      },
      "widgets_values": [
        "clip_l.safetensors",
        "t5/t5xxl_fp8_e4m3fn.safetensors",
        "flux",
        "default"
      ],
      "color": "#322",
      "bgcolor": "#533"
    },
    {
      "id": 173,
      "type": "PreviewImage",
      "pos": [
        315.0151672363281,
        859.9999389648438
      ],
      "size": [
        420,
        310
      ],
      "flags": {},
      "order": 48,
      "mode": 4,
      "inputs": [
        {
          "label": "images",
          "name": "images",
          "type": "IMAGE",
          "link": 289
        }
      ],
      "outputs": [],
      "properties": {
        "cnr_id": "comfy-core",
        "ver": "0.3.40",
        "Node name for S&R": "PreviewImage",
        "widget_ue_connectable": {}
      },
      "widgets_values": []
    },
    {
      "id": 177,
      "type": "ReferenceLatent",
      "pos": [
        -18.197790145874023,
        121.75436401367188
      ],
      "size": [
        197.712890625,
        46
      ],
      "flags": {},
      "order": 50,
      "mode": 4,
      "inputs": [
        {
          "label": "conditioning",
          "name": "conditioning",
          "type": "CONDITIONING",
          "link": 340
        },
        {
          "label": "latent",
          "name": "latent",
          "shape": 7,
          "type": "LATENT",
          "link": 293
        }
      ],
      "outputs": [
        {
          "label": "CONDITIONING",
          "name": "CONDITIONING",
          "type": "CONDITIONING",
          "links": [
            292
          ]
        }
      ],
      "properties": {
        "cnr_id": "comfy-core",
        "ver": "0.3.41",
        "Node name for S&R": "ReferenceLatent",
        "widget_ue_connectable": {}
      },
      "widgets_values": []
    },
    {
      "id": 124,
      "type": "VAEEncode",
      "pos": [
        3.938443422317505,
        359.56829833984375
      ],
      "size": [
        240,
        50
      ],
      "flags": {
        "collapsed": false
      },
      "order": 47,
      "mode": 4,
      "inputs": [
        {
          "label": "pixels",
          "name": "pixels",
          "type": "IMAGE",
          "link": 222
        },
        {
          "label": "vae",
          "name": "vae",
          "type": "VAE",
          "link": 223
        }
      ],
      "outputs": [
        {
          "label": "LATENT",
          "name": "LATENT",
          "type": "LATENT",
          "links": [
            291,
            293
          ]
        }
      ],
      "properties": {
        "cnr_id": "comfy-core",
        "ver": "0.3.39",
        "Node name for S&R": "VAEEncode",
        "widget_ue_connectable": {}
      },
      "widgets_values": []
    },
    {
      "id": 42,
      "type": "FluxKontextImageScale",
      "pos": [
        -57.539554595947266,
        557.66259765625
      ],
      "size": [
        270,
        30
      ],
      "flags": {
        "collapsed": false
      },
      "order": 44,
      "mode": 4,
      "inputs": [
        {
          "label": "image",
          "name": "image",
          "type": "IMAGE",
          "link": 251
        }
      ],
      "outputs": [
        {
          "label": "IMAGE",
          "name": "IMAGE",
          "type": "IMAGE",
          "links": [
            222,
            289
          ]
        }
      ],
      "properties": {
        "cnr_id": "comfy-core",
        "ver": "0.3.38",
        "Node name for S&R": "FluxKontextImageScale",
        "widget_ue_connectable": {}
      },
      "widgets_values": []
    },
    {
      "id": 209,
      "type": "ShowText|pysssss",
      "pos": [
        -4151.24951171875,
        -356.92303466796875
      ],
      "size": [
        363.92352294921875,
        132.54635620117188
      ],
      "flags": {},
      "order": 27,
      "mode": 4,
      "inputs": [
        {
          "label": "text",
          "name": "text",
          "type": "STRING",
          "link": 353
        }
      ],
      "outputs": [
        {
          "label": "STRING",
          "name": "STRING",
          "shape": 6,
          "type": "STRING",
          "links": null
        }
      ],
      "properties": {
        "cnr_id": "comfyui-custom-scripts",
        "ver": "1.2.5",
        "Node name for S&R": "ShowText|pysssss",
        "widget_ue_connectable": {}
      },
      "widgets_values": [
        "{\n  \"annotations\": [\n    {\n      \"id\": \"annotation_1752728039209_27thl1uv6\",\n      \"type\": \"rectangle\",\n      \"color\": \"#ff0000\",\n      \"fillMode\": \"filled\",\n      \"opacity\": 100,\n      \"number\": 0,\n      \"geometry\": {\n        \"type\": \"rectangle\",\n        \"coordinates\": [\n          267.308948610491,\n          617.5652675209434,\n          606.6038435912343,\n          692.1705975072243\n        ]\n      },\n      \"start\": {\n        \"x\": 267.308948610491,\n        \"y\": 617.5652675209434\n      },\n      \"end\": {\n        \"x\": 606.6038435912343,\n        \"y\": 692.1705975072243\n      }\n    }\n  ],\n  \"operation_type\": \"global_color_grade\",\n  \"target_description\": \"\",\n  \"constraint_prompts\": [\n    \"respecting spatial relationships\"\n  ],\n  \"decorative_prompts\": [\n    \"natural positioning\"\n  ],\n  \"selected_annotations\": [\n    {\n      \"id\": \"annotation_1752728039209_27thl1uv6\",\n      \"operationType\": \"add_object\",\n      \"description\": \"bridge\",\n      \"type\": \"rectangle\",\n      \"color\": \"#ff0000\",\n      \"number\": 0,\n      \"constraintPrompts\": [\n        \"respecting spatial relationships\"\n      ],\n      \"decorativePrompts\": [\n        \"natural positioning\"\n      ]\n    }\n  ],\n  \"multi_layer_operations\": false\n}"
      ]
    },
    {
      "id": 210,
      "type": "ShowText|pysssss",
      "pos": [
        -4157.14404296875,
        -132.1768798828125
      ],
      "size": [
        371.4630432128906,
        139.33189392089844
      ],
      "flags": {},
      "order": 28,
      "mode": 4,
      "inputs": [
        {
          "label": "text",
          "name": "text",
          "type": "STRING",
          "link": 354
        }
      ],
      "outputs": [
        {
          "label": "STRING",
          "name": "STRING",
          "shape": 6,
          "type": "STRING",
          "links": null
        }
      ],
      "properties": {
        "cnr_id": "comfyui-custom-scripts",
        "ver": "1.2.5",
        "Node name for S&R": "ShowText|pysssss",
        "widget_ue_connectable": {}
      },
      "widgets_values": [
        "OPERATION: add bridge to the red rectangular marked area, respecting spatial relationships, natural positioning | CONSTRAINTS: respecting spatial relationships | STYLE: natural positioning | METADATA: annotations_count: 1; operations: add_object(1)"
      ]
    },
    {
      "id": 211,
      "type": "PreviewImage",
      "pos": [
        -3756.190673828125,
        -619.8499145507812
      ],
      "size": [
        308.890625,
        509.82257080078125
      ],
      "flags": {},
      "order": 25,
      "mode": 4,
      "inputs": [
        {
          "label": "images",
          "name": "images",
          "type": "IMAGE",
          "link": 355
        }
      ],
      "outputs": [],
      "properties": {
        "cnr_id": "comfy-core",
        "ver": "0.3.43",
        "Node name for S&R": "PreviewImage",
        "widget_ue_connectable": {}
      },
      "widgets_values": []
    },
    {
      "id": 212,
      "type": "ShowText|pysssss",
      "pos": [
        -3395.645263671875,
        529.5010375976562
      ],
      "size": [
        450.62799072265625,
        188.0995330810547
      ],
      "flags": {},
      "order": 36,
      "mode": 4,
      "inputs": [
        {
          "label": "text",
          "name": "text",
          "type": "STRING",
          "link": 389
        }
      ],
      "outputs": [
        {
          "label": "STRING",
          "name": "STRING",
          "shape": 6,
          "type": "STRING",
          "links": null
        }
      ],
      "properties": {
        "cnr_id": "comfyui-custom-scripts",
        "ver": "1.2.5",
        "Node name for S&R": "ShowText|pysssss",
        "widget_ue_connectable": {}
      },
      "widgets_values": [
        "Generate image editing instructions in Flux Kontext format.\n\nEDITING STRATEGY: style_coherent\nFocus on:\n- Visual style consistency\n- Color harmony and palette coherence\n- Texture and material uniformity\n- Lighting and shadow consistency\n- Overall aesthetic unity\n\nOUTPUT FORMAT:\nOutput clean, natural language descriptions without technical details, annotation numbers, or structured formatting. Focus on the core editing action using color and spatial descriptions (e.g., 'transform the red area into blue', 'remove the object in the center'). Avoid any annotation references like 'annotation 0' or technical instructions.\n\nRules:\n- Output ONLY the formatted instructions\n- Do NOT include code, explanations, or comments\n- Apply the specific editing strategy focus areas listed above\n- Ensure instructions match the strategy requirements"
      ]
    },
    {
      "id": 213,
      "type": "ShowText|pysssss",
      "pos": [
        -3405.30029296875,
        -619.8499145507812
      ],
      "size": [
        420.7154541015625,
        247.98983764648438
      ],
      "flags": {},
      "order": 26,
      "mode": 4,
      "inputs": [
        {
          "label": "text",
          "name": "text",
          "type": "STRING",
          "link": 357
        }
      ],
      "outputs": [
        {
          "label": "STRING",
          "name": "STRING",
          "shape": 6,
          "type": "STRING",
          "links": null
        }
      ],
      "properties": {
        "cnr_id": "comfyui-custom-scripts",
        "ver": "1.2.5",
        "Node name for S&R": "ShowText|pysssss",
        "widget_ue_connectable": {}
      },
      "widgets_values": [
        "add bridge to the red rectangular marked area, respecting spatial relationships, natural positioning"
      ]
    },
    {
      "id": 215,
      "type": "ShowText|pysssss",
      "pos": [
        -3390.112548828125,
        234.70379638671875
      ],
      "size": [
        450.62799072265625,
        188.0995330810547
      ],
      "flags": {},
      "order": 35,
      "mode": 4,
      "inputs": [
        {
          "label": "text",
          "name": "text",
          "type": "STRING",
          "link": 388
        }
      ],
      "outputs": [
        {
          "label": "STRING",
          "name": "STRING",
          "shape": 6,
          "type": "STRING",
          "links": null
        }
      ],
      "properties": {
        "cnr_id": "comfyui-custom-scripts",
        "ver": "1.2.5",
        "Node name for S&R": "ShowText|pysssss",
        "widget_ue_connectable": {}
      },
      "widgets_values": [
        "将红色区域增加一座桥梁"
      ]
    },
    {
      "id": 217,
      "type": "ShowText|pysssss",
      "pos": [
        -3390.6240234375,
        1243.7945556640625
      ],
      "size": [
        450.62799072265625,
        188.0995330810547
      ],
      "flags": {},
      "order": 38,
      "mode": 4,
      "inputs": [
        {
          "label": "text",
          "name": "text",
          "type": "STRING",
          "link": 396
        }
      ],
      "outputs": [
        {
          "label": "STRING",
          "name": "STRING",
          "shape": 6,
          "type": "STRING",
          "links": null
        }
      ],
      "properties": {
        "cnr_id": "comfyui-custom-scripts",
        "ver": "1.2.5",
        "Node name for S&R": "ShowText|pysssss",
        "widget_ue_connectable": {}
      },
      "widgets_values": [
        "Error: Please provide siliconflow API key"
      ]
    },
    {
      "id": 219,
      "type": "ShowText|pysssss",
      "pos": [
        -3390.6240234375,
        963.8931274414062
      ],
      "size": [
        450.62799072265625,
        188.0995330810547
      ],
      "flags": {},
      "order": 37,
      "mode": 4,
      "inputs": [
        {
          "label": "text",
          "name": "text",
          "type": "STRING",
          "link": 395
        }
      ],
      "outputs": [
        {
          "label": "STRING",
          "name": "STRING",
          "shape": 6,
          "type": "STRING",
          "links": null
        }
      ],
      "properties": {
        "cnr_id": "comfyui-custom-scripts",
        "ver": "1.2.5",
        "Node name for S&R": "ShowText|pysssss",
        "widget_ue_connectable": {}
      },
      "widgets_values": []
    },
    {
      "id": 233,
      "type": "Note",
      "pos": [
        -3377.853271484375,
        -261.1710205078125
      ],
      "size": [
        394.9114685058594,
        180.85443115234375
      ],
      "flags": {},
      "order": 10,
      "mode": 4,
      "inputs": [],
      "outputs": [],
      "properties": {
        "widget_ue_connectable": {}
      },
      "widgets_values": [
        "三选一，另外两个需要屏蔽"
      ],
      "color": "#332922",
      "bgcolor": "#593930"
    },
    {
      "id": 146,
      "type": "ImageStitch",
      "pos": [
        -385.2021484375,
        548.0668334960938
      ],
      "size": [
        270,
        150
      ],
      "flags": {},
      "order": 40,
      "mode": 4,
      "inputs": [
        {
          "label": "image1",
          "name": "image1",
          "type": "IMAGE",
          "link": 452
        },
        {
          "label": "image2",
          "name": "image2",
          "shape": 7,
          "type": "IMAGE",
          "link": 250
        }
      ],
      "outputs": [
        {
          "label": "IMAGE",
          "name": "IMAGE",
          "type": "IMAGE",
          "links": [
            251
          ]
        }
      ],
      "properties": {
        "cnr_id": "comfy-core",
        "ver": "0.3.40",
        "Node name for S&R": "ImageStitch",
        "widget_ue_connectable": {}
      },
      "widgets_values": [
        "right",
        true,
        0,
        "white"
      ]
    },
    {
      "id": 204,
      "type": "NunchakuFluxDiTLoader",
      "pos": [
        -507.3382568359375,
        -261.8520812988281
      ],
      "size": [
        275.7613220214844,
        202
      ],
      "flags": {},
      "order": 11,
      "mode": 4,
      "inputs": [],
      "outputs": [
        {
          "label": "MODEL",
          "name": "MODEL",
          "type": "MODEL",
          "links": []
        }
      ],
      "properties": {
        "cnr_id": "ComfyUI-nunchaku",
        "ver": "aee38dd7ee8f88bf5db0a7ce813da67a4f969c88",
        "Node name for S&R": "NunchakuFluxDiTLoader",
        "widget_ue_connectable": {}
      },
      "widgets_values": [
        "nunchaku/svdq-int4_r32-flux.1-kontext-dev.safetensors",
        0.12000000000000002,
        "nunchaku-fp16",
        "auto",
        0,
        "float16",
        "enabled"
      ]
    },
    {
      "id": 37,
      "type": "UNETLoader",
      "pos": [
        -400,
        80
      ],
      "size": [
        337.76861572265625,
        82
      ],
      "flags": {},
      "order": 12,
      "mode": 4,
      "inputs": [],
      "outputs": [
        {
          "label": "MODEL",
          "name": "MODEL",
          "type": "MODEL",
          "links": [
            399
          ]
        }
      ],
      "properties": {
        "cnr_id": "comfy-core",
        "ver": "0.3.38",
        "Node name for S&R": "UNETLoader",
        "models": [
          {
            "name": "flux1-dev-kontext_fp8_scaled.safetensors",
            "url": "https://huggingface.co/Comfy-Org/flux1-kontext-dev_ComfyUI/resolve/main/split_files/diffusion_models/flux1-dev-kontext_fp8_scaled.safetensors",
            "directory": "diffusion_models"
          }
        ],
        "widget_ue_connectable": {}
      },
      "widgets_values": [
        "FLUX/flux1-dev-kontext_fp8_scaled.safetensors",
        "default"
      ],
      "color": "#322",
      "bgcolor": "#533"
    },
    {
      "id": 8,
      "type": "VAEDecode",
      "pos": [
        286.0468444824219,
        368.765625
      ],
      "size": [
        190,
        46
      ],
      "flags": {
        "collapsed": false
      },
      "order": 53,
      "mode": 4,
      "inputs": [
        {
          "label": "samples",
          "name": "samples",
          "type": "LATENT",
          "link": 52
        },
        {
          "label": "vae",
          "name": "vae",
          "type": "VAE",
          "link": 61
        }
      ],
      "outputs": [
        {
          "label": "IMAGE",
          "name": "IMAGE",
          "type": "IMAGE",
          "slot_index": 0,
          "links": [
            400
          ]
        }
      ],
      "properties": {
        "cnr_id": "comfy-core",
        "ver": "0.3.38",
        "Node name for S&R": "VAEDecode",
        "widget_ue_connectable": {}
      },
      "widgets_values": []
    },
    {
      "id": 239,
      "type": "PreviewImage",
      "pos": [
        858.9091796875,
        481.2742614746094
      ],
      "size": [
        410.0351867675781,
        462.0704040527344
      ],
      "flags": {},
      "order": 54,
      "mode": 4,
      "inputs": [
        {
          "label": "images",
          "name": "images",
          "type": "IMAGE",
          "link": 400
        }
      ],
      "outputs": [],
      "properties": {
        "cnr_id": "comfy-core",
        "ver": "0.3.43",
        "Node name for S&R": "PreviewImage",
        "widget_ue_connectable": {}
      },
      "widgets_values": []
    },
    {
      "id": 6,
      "type": "CLIPTextEncode",
      "pos": [
        327.6550598144531,
        560.2886352539062
      ],
      "size": [
        400,
        220
      ],
      "flags": {},
      "order": 46,
      "mode": 4,
      "inputs": [
        {
          "label": "clip",
          "name": "clip",
          "type": "CLIP",
          "link": 59
        },
        {
          "label": "text",
          "name": "text",
          "type": "STRING",
          "widget": {
            "name": "text"
          },
          "link": 418
        }
      ],
      "outputs": [
        {
          "label": "CONDITIONING",
          "name": "CONDITIONING",
          "type": "CONDITIONING",
          "slot_index": 0,
          "links": [
            237,
            340
          ]
        }
      ],
      "title": "CLIP Text Encode (Positive Prompt)",
      "properties": {
        "cnr_id": "comfy-core",
        "ver": "0.3.38",
        "Node name for S&R": "CLIPTextEncode",
        "widget_ue_connectable": {}
      },
      "widgets_values": [
        "Replace the woman’s face with a man’s face,add a red flower to the woman’s arm."
      ],
      "color": "#232",
      "bgcolor": "#353"
    },
    {
      "id": 208,
      "type": "PreviewImage",
      "pos": [
        -4138.43017578125,
        534.3018188476562
      ],
      "size": [
        211.1578826904297,
        258.7719421386719
      ],
      "flags": {},
      "order": 29,
      "mode": 4,
      "inputs": [
        {
          "label": "images",
          "name": "images",
          "type": "IMAGE",
          "link": 352
        }
      ],
      "outputs": [],
      "properties": {
        "cnr_id": "comfy-core",
        "ver": "0.3.43",
        "Node name for S&R": "PreviewImage",
        "widget_ue_connectable": {}
      },
      "widgets_values": []
    },
    {
      "id": 220,
      "type": "VisualPromptEditor",
      "pos": [
        -4157.1689453125,
        247.33741760253906
      ],
      "size": [
        351.06854248046875,
        220
      ],
      "flags": {},
      "order": 22,
      "mode": 4,
      "inputs": [
        {
          "label": "image",
          "name": "image",
          "type": "IMAGE",
          "link": 381
        }
      ],
      "outputs": [
        {
          "label": "processed_image",
          "name": "processed_image",
          "type": "IMAGE",
          "links": [
            352,
            387,
            447
          ]
        },
        {
          "label": "structured_prompt",
          "name": "structured_prompt",
          "type": "STRING",
          "links": [
            386
          ]
        },
        {
          "label": "annotation_data",
          "name": "annotation_data",
          "type": "STRING",
          "links": []
        },
        {
          "label": "model_instruction",
          "name": "model_instruction",
          "type": "STRING",
          "links": null
        }
      ],
      "properties": {
        "aux_id": "aiaiaikkk/Kontext-Visual-Prompt-Window",
        "Node name for S&R": "VisualPromptEditor",
        "ver": "332100f6a29b84d947873210d82e08381a01acdb",
        "widget_ue_connectable": {}
      },
      "widgets_values": [
        "{\"positive_prompt\":\"\",\"negative_prompt\":\"\",\"selected_annotations\":[],\"global_operation_type\":\"global_color_grade\",\"global_description\":\"\",\"template_category\":\"global\",\"constraint_prompts\":[],\"decorative_prompts\":[],\"include_annotation_numbers\":false,\"annotations\":[],\"quality_analysis\":{\"score\":30,\"word_count\":1,\"char_count\":0,\"professional_terms\":0,\"descriptive_terms\":0,\"constraint_terms\":0,\"suggestions\":[\"Prompt needs improvement, add more specific details\",\"Prompt too short, add more details\"],\"grade\":\"D\"},\"editing_mode\":\"hybrid\",\"timestamp\":\"2025-07-17T04:52:30.297Z\"}",
        "",
        "global_color_grade",
        "Visual Editor Ready"
      ],
      "color": "#673AB7",
      "bgcolor": "#512DA8"
    },
    {
      "id": 214,
      "type": "VisualPromptEditor",
      "pos": [
        -4149.259765625,
        -619.8499145507812
      ],
      "size": [
        351.06854248046875,
        220
      ],
      "flags": {},
      "order": 21,
      "mode": 4,
      "inputs": [
        {
          "label": "image",
          "name": "image",
          "type": "IMAGE",
          "link": 380
        }
      ],
      "outputs": [
        {
          "label": "processed_image",
          "name": "processed_image",
          "type": "IMAGE",
          "links": [
            355,
            446
          ]
        },
        {
          "label": "structured_prompt",
          "name": "structured_prompt",
          "type": "STRING",
          "links": [
            357,
            413
          ]
        },
        {
          "label": "annotation_data",
          "name": "annotation_data",
          "type": "STRING",
          "links": [
            353
          ]
        },
        {
          "label": "model_instruction",
          "name": "model_instruction",
          "type": "STRING",
          "links": [
            354
          ]
        }
      ],
      "properties": {
        "aux_id": "aiaiaikkk/Kontext-Visual-Prompt-Window",
        "Node name for S&R": "VisualPromptEditor",
        "ver": "332100f6a29b84d947873210d82e08381a01acdb",
        "widget_ue_connectable": {}
      },
      "widgets_values": [
        "{\"positive_prompt\":\"\",\"negative_prompt\":\"\",\"selected_annotations\":[{\"id\":\"annotation_1752728039209_27thl1uv6\",\"operationType\":\"add_object\",\"description\":\"bridge\",\"type\":\"rectangle\",\"color\":\"#ff0000\",\"number\":0,\"constraintPrompts\":[\"respecting spatial relationships\"],\"decorativePrompts\":[\"natural positioning\"]}],\"global_operation_type\":\"global_color_grade\",\"global_description\":\"\",\"template_category\":\"global\",\"constraint_prompts\":[\"respecting spatial relationships\"],\"decorative_prompts\":[\"natural positioning\"],\"include_annotation_numbers\":false,\"annotations\":[{\"id\":\"annotation_1752728039209_27thl1uv6\",\"type\":\"rectangle\",\"color\":\"#ff0000\",\"fillMode\":\"filled\",\"opacity\":100,\"number\":0,\"geometry\":{\"type\":\"rectangle\",\"coordinates\":[267.308948610491,617.5652675209434,606.6038435912343,692.1705975072243]},\"start\":{\"x\":267.308948610491,\"y\":617.5652675209434},\"end\":{\"x\":606.6038435912343,\"y\":692.1705975072243}}],\"quality_analysis\":{\"score\":30,\"word_count\":1,\"char_count\":0,\"professional_terms\":0,\"descriptive_terms\":0,\"constraint_terms\":0,\"suggestions\":[\"Prompt needs improvement, add more specific details\",\"Prompt too short, add more details\"],\"grade\":\"D\"},\"editing_mode\":\"hybrid\",\"timestamp\":\"2025-07-17T04:55:33.593Z\"}",
        "",
        "global_color_grade",
        "Visual Editor Ready"
      ],
      "color": "#673AB7",
      "bgcolor": "#512DA8"
    },
    {
      "id": 237,
      "type": "OllamaFluxKontextEnhancerV2",
      "pos": [
        -3755.194091796875,
        240.8064422607422
      ],
      "size": [
        307.2640075683594,
        600
      ],
      "flags": {},
      "order": 30,
      "mode": 4,
      "inputs": [
        {
          "label": "annotation_data",
          "name": "annotation_data",
          "type": "STRING",
          "link": 386
        },
        {
          "label": "image",
          "name": "image",
          "shape": 7,
          "type": "IMAGE",
          "link": 387
        }
      ],
      "outputs": [
        {
          "label": "flux_edit_instructions",
          "name": "flux_edit_instructions",
          "type": "STRING",
          "links": [
            388,
            414
          ]
        },
        {
          "label": "system_prompt",
          "name": "system_prompt",
          "type": "STRING",
          "links": [
            389
          ]
        }
      ],
      "properties": {
        "Node name for S&R": "OllamaFluxKontextEnhancerV2",
        "widget_ue_connectable": {}
      },
      "widgets_values": [
        "红色区域增加一座桥梁",
        "deepseek-r1:1.5b",
        "refresh",
        false,
        "creative_design",
        "auto_smart",
        "http://127.0.0.1:11434",
        0.7,
        false,
        1077098704,
        "randomize",
        "none",
        false,
        "My Guidance",
        ""
      ],
      "color": "#673AB7",
      "bgcolor": "#512DA8",
      "boxcolor": "#673AB7",
      "model_selection": "deepseek-r1:1.5b"
    },
    {
      "id": 238,
      "type": "APIFluxKontextEnhancer",
      "pos": [
        -3719.823974609375,
        973.15966796875
      ],
      "size": [
        299.6490173339844,
        460.83258056640625
      ],
      "flags": {},
      "order": 31,
      "mode": 4,
      "inputs": [
        {
          "label": "annotation_data",
          "name": "annotation_data",
          "type": "STRING",
          "link": 393
        },
        {
          "label": "image",
          "name": "image",
          "shape": 7,
          "type": "IMAGE",
          "link": 394
        }
      ],
      "outputs": [
        {
          "label": "flux_edit_instructions",
          "name": "flux_edit_instructions",
          "type": "STRING",
          "links": [
            395,
            415
          ]
        },
        {
          "label": "system_prompt",
          "name": "system_prompt",
          "type": "STRING",
          "links": [
            396,
            398
          ]
        }
      ],
      "properties": {
        "Node name for S&R": "APIFluxKontextEnhancer",
        "widget_ue_connectable": {}
      },
      "widgets_values": [
        "",
        "siliconflow",
        "",
        "deepseek-ai/DeepSeek-V3",
        "",
        "general_editing",
        "auto_smart",
        1057416776926191,
        "randomize",
        "",
        "none",
        "",
        false
      ],
      "color": "#673AB7",
      "bgcolor": "#512DA8",
      "boxcolor": "#673AB7"
    },
    {
      "id": 246,
      "type": "PreviewImage",
      "pos": [
        -4123.41650390625,
        1970.455078125
      ],
      "size": [
        211.1578826904297,
        258.7719421386719
      ],
      "flags": {},
      "order": 32,
      "mode": 0,
      "inputs": [
        {
          "label": "images",
          "name": "images",
          "type": "IMAGE",
          "link": 419
        }
      ],
      "outputs": [],
      "properties": {
        "cnr_id": "comfy-core",
        "ver": "0.3.43",
        "widget_ue_connectable": {},
        "Node name for S&R": "PreviewImage"
      },
      "widgets_values": []
    },
    {
      "id": 247,
      "type": "ShowText|pysssss",
      "pos": [
        -3391.559326171875,
        1970.51123046875
      ],
      "size": [
        450.62799072265625,
        188.0995330810547
      ],
      "flags": {},
      "order": 43,
      "mode": 0,
      "inputs": [
        {
          "label": "text",
          "name": "text",
          "type": "STRING",
          "link": 433
        }
      ],
      "outputs": [
        {
          "label": "STRING",
          "name": "STRING",
          "shape": 6,
          "type": "STRING",
          "links": null
        }
      ],
      "properties": {
        "cnr_id": "comfyui-custom-scripts",
        "ver": "1.2.5",
        "widget_ue_connectable": {},
        "Node name for S&R": "ShowText|pysssss"
      },
      "widgets_values": [
        "你是专业的图像编辑AI助手，请根据用户需求生成精确的编辑指令。\n\n\n## 操作分析\n- **操作类型**: adjust\n- **目标对象**: 对象\n- **目标属性**: 外观\n- **空间信息**: 指定区域\n- **用户描述**: 变暗\n\n## 专业要求\n### 质量标准\n- 自然真实\n- 无违和感\n- 高质量\n\n\n## 输出要求\n请根据以上分析，生成精确的Flux Kontext编辑指令。指令应该：\n1. 准确描述操作内容和目标\n2. 包含必要的质量和技术要求\n3. 考虑场景的整体协调性\n4. 使用专业的图像编辑术语\n5. 提供多样化的实现方案\n6. 确保专业级别的输出质量\n\n请确保指令具有可执行性、专业性和完整性，并遵循专业化指令的要求。"
      ]
    },
    {
      "id": 248,
      "type": "ShowText|pysssss",
      "pos": [
        -3386.026611328125,
        1675.714111328125
      ],
      "size": [
        450.62799072265625,
        188.0995330810547
      ],
      "flags": {},
      "order": 41,
      "mode": 0,
      "inputs": [
        {
          "label": "text",
          "name": "text",
          "type": "STRING",
          "link": 432
        }
      ],
      "outputs": [
        {
          "label": "STRING",
          "name": "STRING",
          "shape": 6,
          "type": "STRING",
          "links": null
        }
      ],
      "properties": {
        "cnr_id": "comfyui-custom-scripts",
        "ver": "1.2.5",
        "widget_ue_connectable": {},
        "Node name for S&R": "ShowText|pysssss"
      },
      "widgets_values": [
        "Adjust the exposure of the red horizontal rectangle area to make it darker, ensuring the overall image remains natural and visually coherent."
      ]
    },
    {
      "id": 226,
      "type": "Reroute",
      "pos": [
        -4811.189453125,
        -91.72815704345703
      ],
      "size": [
        75,
        26
      ],
      "flags": {},
      "order": 20,
      "mode": 0,
      "inputs": [
        {
          "label": "",
          "name": "",
          "type": "*",
          "link": 379
        }
      ],
      "outputs": [
        {
          "label": "",
          "name": "",
          "type": "IMAGE",
          "links": [
            380,
            381,
            382,
            425
          ]
        }
      ],
      "properties": {
        "showOutputText": false,
        "horizontal": false,
        "widget_ue_connectable": {}
      }
    },
    {
      "id": 236,
      "type": "Note",
      "pos": [
        -4451.8076171875,
        973.12255859375
      ],
      "size": [
        251.38685607910156,
        161.54998779296875
      ],
      "flags": {},
      "order": 13,
      "mode": 4,
      "inputs": [],
      "outputs": [],
      "properties": {
        "widget_ue_connectable": {}
      },
      "widgets_values": [
        "四选一，另外两个需要屏蔽"
      ],
      "color": "#332922",
      "bgcolor": "#593930"
    },
    {
      "id": 251,
      "type": "Note",
      "pos": [
        -4445.19140625,
        1713.47607421875
      ],
      "size": [
        251.38685607910156,
        161.54998779296875
      ],
      "flags": {},
      "order": 14,
      "mode": 4,
      "inputs": [],
      "outputs": [],
      "properties": {
        "widget_ue_connectable": {}
      },
      "widgets_values": [
        "四选一，另外两个需要屏蔽"
      ],
      "color": "#332922",
      "bgcolor": "#593930"
    },
    {
      "id": 252,
      "type": "Note",
      "pos": [
        -4429.20751953125,
        289.7669372558594
      ],
      "size": [
        251.38685607910156,
        161.54998779296875
      ],
      "flags": {},
      "order": 15,
      "mode": 4,
      "inputs": [],
      "outputs": [],
      "properties": {
        "widget_ue_connectable": {}
      },
      "widgets_values": [
        "四选一，另外两个需要屏蔽"
      ],
      "color": "#332922",
      "bgcolor": "#593930"
    },
    {
      "id": 253,
      "type": "Note",
      "pos": [
        -4472.14453125,
        -578.43505859375
      ],
      "size": [
        251.38685607910156,
        161.54998779296875
      ],
      "flags": {},
      "order": 16,
      "mode": 4,
      "inputs": [],
      "outputs": [],
      "properties": {
        "widget_ue_connectable": {}
      },
      "widgets_values": [
        "四选一，另外两个需要屏蔽"
      ],
      "color": "#332922",
      "bgcolor": "#593930"
    },
    {
      "id": 255,
      "type": "TextGenWebUIFluxKontextEnhancer",
      "pos": [
        -3741.02880859375,
        1684.053466796875
      ],
      "size": [
        325.35882568359375,
        533.712890625
      ],
      "flags": {},
      "order": 34,
      "mode": 0,
      "inputs": [
        {
          "label": "annotation_data",
          "name": "annotation_data",
          "type": "STRING",
          "link": 431
        },
        {
          "label": "image",
          "name": "image",
          "shape": 7,
          "type": "IMAGE",
          "link": 430
        }
      ],
      "outputs": [
        {
          "label": "flux_edit_instructions",
          "name": "flux_edit_instructions",
          "type": "STRING",
          "links": [
            432,
            435
          ]
        },
        {
          "label": "system_prompt",
          "name": "system_prompt",
          "type": "STRING",
          "links": [
            433
          ]
        }
      ],
      "properties": {
        "widget_ue_connectable": {},
        "Node name for S&R": "TextGenWebUIFluxKontextEnhancer"
      },
      "widgets_values": [
        "变暗",
        "Qwen_Qwen2.5-1.5B-Instruct",
        "refresh",
        false,
        "general_editing",
        "auto_smart",
        "http://127.0.0.1:5000",
        0.7,
        2592958549,
        "randomize",
        false,
        "none",
        false,
        "My Guidance",
        ""
      ],
      "color": "#673AB7",
      "bgcolor": "#512DA8",
      "boxcolor": "#673AB7"
    },
    {
      "id": 147,
      "type": "LoadImageOutput",
      "pos": [
        -39.96500015258789,
        771.0084228515625
      ],
      "size": [
        320,
        374
      ],
      "flags": {},
      "order": 17,
      "mode": 4,
      "inputs": [],
      "outputs": [
        {
          "label": "IMAGE",
          "name": "IMAGE",
          "type": "IMAGE",
          "links": [
            250
          ]
        },
        {
          "label": "MASK",
          "name": "MASK",
          "type": "MASK",
          "links": null
        }
      ],
      "properties": {
        "cnr_id": "comfy-core",
        "ver": "0.3.40",
        "Node name for S&R": "LoadImageOutput",
        "widget_ue_connectable": {}
      },
      "widgets_values": [
        "ComfyUI_00343_.png [output]",
        false,
        "refresh",
        "image"
      ],
      "color": "#322",
      "bgcolor": "#533"
    },
    {
      "id": 142,
      "type": "LoadImageOutput",
      "pos": [
        -396.0210266113281,
        755.9508666992188
      ],
      "size": [
        320,
        374
      ],
      "flags": {},
      "order": 18,
      "mode": 0,
      "inputs": [],
      "outputs": [
        {
          "label": "IMAGE",
          "name": "IMAGE",
          "type": "IMAGE",
          "links": [
            379
          ]
        },
        {
          "label": "MASK",
          "name": "MASK",
          "type": "MASK",
          "links": null
        }
      ],
      "properties": {
        "cnr_id": "comfy-core",
        "ver": "0.3.40",
        "Node name for S&R": "LoadImageOutput",
        "widget_ue_connectable": {}
      },
      "widgets_values": [
        "大草原.jfif [output]",
        false,
        "refresh",
        "image"
      ],
      "color": "#322",
      "bgcolor": "#533"
    },
    {
      "id": 249,
      "type": "VisualPromptEditor",
      "pos": [
        -4140.26611328125,
        1690.609375
      ],
      "size": [
        351.06854248046875,
        220
      ],
      "flags": {},
      "order": 24,
      "mode": 0,
      "inputs": [
        {
          "label": "image",
          "name": "image",
          "type": "IMAGE",
          "link": 425
        }
      ],
      "outputs": [
        {
          "label": "processed_image",
          "name": "processed_image",
          "type": "IMAGE",
          "links": [
            419,
            430,
            449
          ]
        },
        {
          "label": "structured_prompt",
          "name": "structured_prompt",
          "type": "STRING",
          "links": []
        },
        {
          "label": "annotation_data",
          "name": "annotation_data",
          "type": "STRING",
          "links": [
            431
          ]
        },
        {
          "label": "model_instruction",
          "name": "model_instruction",
          "type": "STRING",
          "links": null
        }
      ],
      "properties": {
        "aux_id": "aiaiaikkk/Kontext-Visual-Prompt-Window",
        "widget_ue_connectable": {},
        "Node name for S&R": "VisualPromptEditor",
        "ver": "332100f6a29b84d947873210d82e08381a01acdb"
      },
      "widgets_values": [
        "{\"positive_prompt\":\"\",\"negative_prompt\":\"\",\"selected_annotations\":[{\"id\":\"annotation_1752905703264_drc4cdux0\",\"operationType\":\"add_object\",\"description\":\"\",\"type\":\"rectangle\",\"color\":\"#ff0000\",\"number\":0,\"constraintPrompts\":[],\"decorativePrompts\":[]}],\"global_operation_type\":\"global_color_grade\",\"global_description\":\"\",\"template_category\":\"global\",\"constraint_prompts\":[],\"decorative_prompts\":[],\"include_annotation_numbers\":false,\"annotations\":[{\"id\":\"annotation_1752905703264_drc4cdux0\",\"type\":\"rectangle\",\"color\":\"#ff0000\",\"fillMode\":\"filled\",\"opacity\":50,\"number\":0,\"geometry\":{\"type\":\"rectangle\",\"coordinates\":[105.14594733292991,127.65693394436498,499.32678120761693,271.8939052511749]},\"start\":{\"x\":105.14594733292991,\"y\":127.65693394436498},\"end\":{\"x\":499.32678120761693,\"y\":271.8939052511749}}],\"quality_analysis\":{\"score\":30,\"word_count\":1,\"char_count\":0,\"professional_terms\":0,\"descriptive_terms\":0,\"constraint_terms\":0,\"suggestions\":[\"Prompt needs improvement, add more specific details\",\"Prompt too short, add more details\"],\"grade\":\"D\"},\"editing_mode\":\"hybrid\",\"timestamp\":\"2025-07-19T06:15:04.003Z\"}",
        "",
        "global_color_grade",
        "Visual Editor Ready"
      ],
      "color": "#673AB7",
      "bgcolor": "#512DA8"
    },
    {
      "id": 243,
      "type": "Any Switch (rgthree)",
      "pos": [
        -2590.711669921875,
        78.02142333984375
      ],
      "size": [
        250.08045959472656,
        106
      ],
      "flags": {},
      "order": 42,
      "mode": 0,
      "inputs": [
        {
          "dir": 3,
          "label": "any_01",
          "name": "any_01",
          "type": "STRING",
          "link": 413
        },
        {
          "dir": 3,
          "label": "any_02",
          "name": "any_02",
          "type": "STRING",
          "link": 414
        },
        {
          "dir": 3,
          "label": "any_03",
          "name": "any_03",
          "type": "STRING",
          "link": 415
        },
        {
          "dir": 3,
          "label": "any_04",
          "name": "any_04",
          "type": "STRING",
          "link": 435
        },
        {
          "dir": 3,
          "name": "any_05",
          "type": "STRING",
          "link": null
        }
      ],
      "outputs": [
        {
          "dir": 4,
          "label": "STRING",
          "name": "*",
          "shape": 3,
          "type": "STRING",
          "links": [
            416,
            418
          ]
        }
      ],
      "properties": {
        "cnr_id": "rgthree-comfy",
        "ver": "1.0.2505182359",
        "widget_ue_connectable": {}
      },
      "widgets_values": []
    },
    {
      "id": 216,
      "type": "VisualPromptEditor",
      "pos": [
        -4111.4345703125,
        968.4168090820312
      ],
      "size": [
        351.06854248046875,
        220
      ],
      "flags": {},
      "order": 23,
      "mode": 4,
      "inputs": [
        {
          "label": "image",
          "name": "image",
          "type": "IMAGE",
          "link": 382
        }
      ],
      "outputs": [
        {
          "label": "processed_image",
          "name": "processed_image",
          "type": "IMAGE",
          "links": [
            370,
            394,
            448
          ]
        },
        {
          "label": "structured_prompt",
          "name": "structured_prompt",
          "type": "STRING",
          "links": [
            393
          ]
        },
        {
          "label": "annotation_data",
          "name": "annotation_data",
          "type": "STRING",
          "links": [
            392
          ]
        },
        {
          "label": "model_instruction",
          "name": "model_instruction",
          "type": "STRING",
          "links": null
        }
      ],
      "properties": {
        "aux_id": "aiaiaikkk/Kontext-Visual-Prompt-Window",
        "Node name for S&R": "VisualPromptEditor",
        "ver": "332100f6a29b84d947873210d82e08381a01acdb",
        "widget_ue_connectable": {}
      },
      "widgets_values": [
        "{\"positive_prompt\":\"\",\"negative_prompt\":\"\",\"selected_annotations\":[],\"global_operation_type\":\"global_color_grade\",\"global_description\":\"\",\"template_category\":\"global\",\"constraint_prompts\":[],\"decorative_prompts\":[],\"include_annotation_numbers\":false,\"annotations\":[{\"id\":\"annotation_1752475120963_88a260t6p\",\"type\":\"rectangle\",\"color\":\"#ff0000\",\"fillMode\":\"filled\",\"opacity\":50,\"number\":0,\"geometry\":{\"type\":\"rectangle\",\"coordinates\":[242.72444067249924,222.7060300156017,506.7142651773159,423.0114413733845]},\"start\":{\"x\":242.72444067249924,\"y\":222.7060300156017},\"end\":{\"x\":506.7142651773159,\"y\":423.0114413733845}}],\"quality_analysis\":{\"score\":30,\"word_count\":1,\"char_count\":0,\"professional_terms\":0,\"descriptive_terms\":0,\"constraint_terms\":0,\"suggestions\":[\"Prompt needs improvement, add more specific details\",\"Prompt too short, add more details\"],\"grade\":\"D\"},\"editing_mode\":\"hybrid\",\"timestamp\":\"2025-07-14T11:44:25.307Z\"}",
        "",
        "global_color_grade",
        "Visual Editor Ready"
      ],
      "color": "#673AB7",
      "bgcolor": "#512DA8"
    },
    {
      "id": 267,
      "type": "PreviewImage",
      "pos": [
        -2186.774169921875,
        -153.6050567626953
      ],
      "size": [
        140,
        246
      ],
      "flags": {},
      "order": 39,
      "mode": 0,
      "inputs": [
        {
          "label": "images",
          "name": "images",
          "type": "IMAGE",
          "link": 451
        }
      ],
      "outputs": [],
      "properties": {
        "cnr_id": "comfy-core",
        "ver": "0.3.43",
        "widget_ue_connectable": {},
        "Node name for S&R": "PreviewImage"
      },
      "widgets_values": []
    },
    {
      "id": 265,
      "type": "CR Image Input Switch (4 way)",
      "pos": [
        -2589.497314453125,
        -114.04407501220703
      ],
      "size": [
        265.79486083984375,
        118
      ],
      "flags": {},
      "order": 33,
      "mode": 0,
      "inputs": [
        {
          "label": "image1",
          "name": "image1",
          "shape": 7,
          "type": "IMAGE",
          "link": 446
        },
        {
          "label": "image2",
          "name": "image2",
          "shape": 7,
          "type": "IMAGE",
          "link": 447
        },
        {
          "label": "image3",
          "name": "image3",
          "shape": 7,
          "type": "IMAGE",
          "link": 448
        },
        {
          "label": "image4",
          "name": "image4",
          "shape": 7,
          "type": "IMAGE",
          "link": 449
        }
      ],
      "outputs": [
        {
          "label": "IMAGE",
          "name": "IMAGE",
          "type": "IMAGE",
          "links": [
            451,
            452
          ]
        },
        {
          "label": "show_help",
          "name": "show_help",
          "type": "STRING",
          "links": null
        }
      ],
      "properties": {
        "cnr_id": "ComfyUI_Comfyroll_CustomNodes",
        "ver": "d78b780ae43fcf8c6b7c6505e6ffb4584281ceca",
        "widget_ue_connectable": {},
        "Node name for S&R": "CR Image Input Switch (4 way)"
      },
      "widgets_values": [
        4
      ]
    },
    {
      "id": 244,
      "type": "ShowText|pysssss",
      "pos": [
        -2227.033447265625,
        282.31915283203125
      ],
      "size": [
        305.7446594238281,
        138.31002807617188
      ],
      "flags": {},
      "order": 45,
      "mode": 0,
      "inputs": [
        {
          "label": "text",
          "name": "text",
          "type": "STRING",
          "link": 416
        }
      ],
      "outputs": [
        {
          "label": "STRING",
          "name": "STRING",
          "shape": 6,
          "type": "STRING",
          "links": null
        }
      ],
      "properties": {
        "cnr_id": "comfyui-custom-scripts",
        "ver": "1.2.5",
        "Node name for S&R": "ShowText|pysssss",
        "widget_ue_connectable": {}
      },
      "widgets_values": [
        "Adjust the exposure of the red horizontal rectangle area to make it darker, ensuring the overall image remains natural and visually coherent."
      ]
    },
    {
      "id": 268,
      "type": "Note",
      "pos": [
        -2588.392333984375,
        -253.29251098632812
      ],
      "size": [
        252.63304138183594,
        88
      ],
      "flags": {},
      "order": 19,
      "mode": 0,
      "inputs": [],
      "outputs": [],
      "properties": {
        "widget_ue_connectable": {}
      },
      "widgets_values": [
        "四选一，左侧四个节点组用哪个Input就输入哪个"
      ],
      "color": "#332922",
      "bgcolor": "#593930"
    }
  ],
  "links": [
    [
      52,
      31,
      0,
      8,
      0,
      "LATENT"
    ],
    [
      57,
      35,
      0,
      31,
      1,
      "CONDITIONING"
    ],
    [
      59,
      38,
      0,
      6,
      0,
      "CLIP"
    ],
    [
      61,
      39,
      0,
      8,
      1,
      "VAE"
    ],
    [
      222,
      42,
      0,
      124,
      0,
      "IMAGE"
    ],
    [
      223,
      39,
      0,
      124,
      1,
      "VAE"
    ],
    [
      237,
      6,
      0,
      135,
      0,
      "CONDITIONING"
    ],
    [
      238,
      135,
      0,
      31,
      2,
      "CONDITIONING"
    ],
    [
      250,
      147,
      0,
      146,
      1,
      "IMAGE"
    ],
    [
      251,
      146,
      0,
      42,
      0,
      "IMAGE"
    ],
    [
      289,
      42,
      0,
      173,
      0,
      "IMAGE"
    ],
    [
      291,
      124,
      0,
      31,
      3,
      "LATENT"
    ],
    [
      292,
      177,
      0,
      35,
      0,
      "CONDITIONING"
    ],
    [
      293,
      124,
      0,
      177,
      1,
      "LATENT"
    ],
    [
      340,
      6,
      0,
      177,
      0,
      "CONDITIONING"
    ],
    [
      352,
      220,
      0,
      208,
      0,
      "IMAGE"
    ],
    [
      353,
      214,
      2,
      209,
      0,
      "STRING"
    ],
    [
      354,
      214,
      3,
      210,
      0,
      "STRING"
    ],
    [
      355,
      214,
      0,
      211,
      0,
      "IMAGE"
    ],
    [
      357,
      214,
      1,
      213,
      0,
      "STRING"
    ],
    [
      370,
      216,
      0,
      222,
      2,
      "IMAGE"
    ],
    [
      379,
      142,
      0,
      226,
      0,
      "*"
    ],
    [
      380,
      226,
      0,
      214,
      0,
      "IMAGE"
    ],
    [
      381,
      226,
      0,
      220,
      0,
      "IMAGE"
    ],
    [
      382,
      226,
      0,
      216,
      0,
      "IMAGE"
    ],
    [
      386,
      220,
      1,
      237,
      0,
      "STRING"
    ],
    [
      387,
      220,
      0,
      237,
      1,
      "IMAGE"
    ],
    [
      388,
      237,
      0,
      215,
      0,
      "STRING"
    ],
    [
      389,
      237,
      1,
      212,
      0,
      "STRING"
    ],
    [
      392,
      216,
      2,
      225,
      3,
      "STRING"
    ],
    [
      393,
      216,
      1,
      238,
      0,
      "STRING"
    ],
    [
      394,
      216,
      0,
      238,
      1,
      "IMAGE"
    ],
    [
      395,
      238,
      0,
      219,
      0,
      "STRING"
    ],
    [
      396,
      238,
      1,
      217,
      0,
      "STRING"
    ],
    [
      398,
      238,
      1,
      225,
      2,
      "STRING"
    ],
    [
      399,
      37,
      0,
      31,
      0,
      "MODEL"
    ],
    [
      400,
      8,
      0,
      239,
      0,
      "IMAGE"
    ],
    [
      413,
      214,
      1,
      243,
      0,
      "*"
    ],
    [
      414,
      237,
      0,
      243,
      1,
      "STRING"
    ],
    [
      415,
      238,
      0,
      243,
      2,
      "STRING"
    ],
    [
      416,
      243,
      0,
      244,
      0,
      "STRING"
    ],
    [
      418,
      243,
      0,
      6,
      1,
      "STRING"
    ],
    [
      419,
      249,
      0,
      246,
      0,
      "IMAGE"
    ],
    [
      425,
      226,
      0,
      249,
      0,
      "IMAGE"
    ],
    [
      430,
      249,
      0,
      255,
      1,
      "IMAGE"
    ],
    [
      431,
      249,
      2,
      255,
      0,
      "STRING"
    ],
    [
      432,
      255,
      0,
      248,
      0,
      "STRING"
    ],
    [
      433,
      255,
      1,
      247,
      0,
      "STRING"
    ],
    [
      435,
      255,
      0,
      243,
      3,
      "STRING"
    ],
    [
      446,
      214,
      0,
      265,
      0,
      "IMAGE"
    ],
    [
      447,
      220,
      0,
      265,
      1,
      "IMAGE"
    ],
    [
      448,
      216,
      0,
      265,
      2,
      "IMAGE"
    ],
    [
      449,
      249,
      0,
      265,
      3,
      "IMAGE"
    ],
    [
      451,
      265,
      0,
      267,
      0,
      "IMAGE"
    ],
    [
      452,
      265,
      0,
      146,
      0,
      "IMAGE"
    ]
  ],
  "groups": [
    {
      "id": 1,
      "title": "Step 1- Load models",
      "bounding": [
        -410,
        10,
        360,
        450
      ],
      "color": "#3f789e",
      "font_size": 24,
      "flags": {}
    },
    {
      "id": 3,
      "title": "Step 2 - Upload images",
      "bounding": [
        -410,
        480,
        700,
        680
      ],
      "color": "#3f789e",
      "font_size": 24,
      "flags": {}
    },
    {
      "id": 5,
      "title": "Step 3 - Prompt",
      "bounding": [
        310,
        480,
        430,
        330
      ],
      "color": "#3f789e",
      "font_size": 24,
      "flags": {}
    },
    {
      "id": 6,
      "title": "Conditioning",
      "bounding": [
        -30,
        10,
        540,
        250
      ],
      "color": "#3f789e",
      "font_size": 24,
      "flags": {}
    },
    {
      "id": 7,
      "title": "系统预设",
      "bounding": [
        -4501.89794921875,
        -703.8499755859375,
        1582.69775390625,
        759.0355224609375
      ],
      "color": "#3f789e",
      "font_size": 24,
      "flags": {}
    },
    {
      "id": 8,
      "title": "本地ollama调用",
      "bounding": [
        -4496.990234375,
        165.59918212890625,
        1571.9727783203125,
        655.3299560546875
      ],
      "color": "#3f789e",
      "font_size": 24,
      "flags": {}
    },
    {
      "id": 9,
      "title": "API远程调用",
      "bounding": [
        -4491.96923828125,
        879.8931274414062,
        1571.9727783203125,
        655.3299560546875
      ],
      "color": "#3f789e",
      "font_size": 24,
      "flags": {}
    },
    {
      "id": 10,
      "title": "TextGen WebUI FLUX Kontext Enhancer",
      "bounding": [
        -4492.90380859375,
        1606.609375,
        1586.6651611328125,
        746.4227294921875
      ],
      "color": "#3f789e",
      "font_size": 24,
      "flags": {}
    }
  ],
  "config": {},
  "extra": {
    "ds": {
      "scale": 0.15772225476662968,
      "offset": [
        7831.53544299608,
        1620.3686146360192
      ]
    },
    "frontendVersion": "1.23.4",
    "groupNodes": {},
    "VHS_latentpreview": false,
    "VHS_latentpreviewrate": 0,
    "VHS_MetadataImage": true,
    "VHS_KeepIntermediate": true,
    "ue_links": [],
    "links_added_by_ue": []
  },
  "version": 0.4
}